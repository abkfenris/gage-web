

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Local Development &mdash; Gage-Web 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Gage-Web 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Server Documentation" href="index.html"/>
        <link rel="prev" title="fabfile.py" href="fabfile.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Gage-Web
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api.html">Gage-Web API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api.html#api">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Gage-Web Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/app.html">app package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#subpackages">Subpackages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/app.admin.html">app.admin package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/app.api_1_0.html">app.api_1_0 package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/app.main.html">app.main package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#submodules">Submodules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#module-app.admin">app.admin module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#app-api-module">app.api module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#app-auth-module">app.auth module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#app-backup-module">app.backup module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#module-app.models">app.models module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/app.html#module-app">Module contents</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/config.html">config module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/manage.html">manage module</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Server Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fabfile.html">fabfile.py</a><ul>
<li class="toctree-l3"><a class="reference internal" href="fabfile.html#hosts">Hosts</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Local Development</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#initial-migration">Initial Migration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#working-with-users-and-roles">Working with Users and Roles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#roles">Roles</a></li>
<li class="toctree-l4"><a class="reference internal" href="#users">Users</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-everything">Running Everything</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Gage-Web</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Server Documentation</a> &raquo;</li>
      
    <li>Local Development</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/developers/local.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="local-development">
<h1>Local Development<a class="headerlink" href="#local-development" title="Permalink to this headline">¶</a></h1>
<p>If you&#8217;re running it locally for development, you&#8217;ll need
<a class="reference external" href="http://www.postgresql.org">Postgres 9.4</a> with <a class="reference external" href="http://postgis.net">Postgis</a>
and <a class="reference external" href="http://redis.io">Redis</a> as the two major backends.</p>
<p>To setup an empty database, <tt class="docutils literal"><span class="pre">psql</span></tt> in, create it and add the postgres
extensions.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>psql -c <span class="s2">&quot;CREATE DATABASE gage-web;&quot;</span>
<span class="nv">$ </span>psql -d gage-web -c <span class="s2">&quot;CREATE EXTENSION postgis;&quot;</span>
<span class="nv">$ </span>pqsl -d gage-web -c <span class="s2">&quot;CREATE EXTENSION postgis_topology;&quot;</span>
</pre></div>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>I suggest developing with a virtual environment.
<a class="reference external" href="http://virtualenvwrapper.readthedocs.org">virtualenvwrapper</a> makes working
with virtual environments much easier.</p>
<p>Then you can install the requirements. There are additional requirements for
development.</p>
<p>If you poke around in <tt class="docutils literal"><span class="pre">requirements.txt</span></tt> and the <tt class="docutils literal"><span class="pre">requirements</span></tt>
folder, you&#8217;ll notice that the dependencies have been broken into seperate
files. This is so that production servers and testing doesn&#8217;t need to install
everything.</p>
<p>Also <a class="reference external" href="http://travis-ci.org">Travis CI</a> will install some packages much faster
with <a class="reference external" href="http://conda.pydata.org/miniconda.html">miniconda</a> than with <cite>pip</cite>.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install -r requirements/develop.txt
</pre></div>
</div>
<p>If you are using a virtual environment, the following all assumes that it is
active.</p>
</div>
<div class="section" id="environment-variables">
<h2>Environment Variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>Once you have your database and redis setup, you&#8217;ll need to set the environment
variables expected in <tt class="docutils literal"><span class="pre">config.py</span></tt>.</p>
<p>If you are using a virtual environment, you can add the variables to the
<tt class="docutils literal"><span class="pre">activate</span></tt> file in the <tt class="docutils literal"><span class="pre">env/bin</span></tt>.</p>
</div>
<div class="section" id="initial-migration">
<h2>Initial Migration<a class="headerlink" href="#initial-migration" title="Permalink to this headline">¶</a></h2>
<p>With your database created, and running, you can use the <tt class="docutils literal"><span class="pre">db</span></tt> functions in
<tt class="docutils literal"><span class="pre">manage.py</span></tt></p>
<p>To get the database ready run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py db init
</pre></div>
</div>
<p>Then you can bring it to the latest version of the schema with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py db upgrade
</pre></div>
</div>
<p>See <a class="reference external" href="http://flask-migrate.readthedocs.org">flask-Migrate</a> for more information.</p>
</div>
<div class="section" id="working-with-users-and-roles">
<h2>Working with Users and Roles<a class="headerlink" href="#working-with-users-and-roles" title="Permalink to this headline">¶</a></h2>
<p><tt class="docutils literal"><span class="pre">manage.py</span></tt> is able to manage users and roles on the server.</p>
<div class="section" id="roles">
<h3>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h3>
<p>Before a user can be assigned a role, the role must exist, so create one with
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">user</span> <span class="pre">create_role</span></tt></p>
<dl class="option">
<dt id="cmdoption-create_role-n">
<span id="cmdoption-create_role--name"></span><tt class="descname">-n</tt><tt class="descclassname"> &lt;name&gt;</tt><tt class="descclassname">, </tt><tt class="descname">--name</tt><tt class="descclassname"> &lt;name&gt;</tt><a class="headerlink" href="#cmdoption-create_role-n" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of role</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-create_role-d">
<span id="cmdoption-create_role--description"></span><tt class="descname">-d</tt><tt class="descclassname"> &lt;description&gt;</tt><tt class="descclassname">, </tt><tt class="descname">--description</tt><tt class="descclassname"> &lt;description&gt;</tt><a class="headerlink" href="#cmdoption-create_role-d" title="Permalink to this definition">¶</a></dt>
<dd><p>Description of role</p>
</dd></dl>

<p>For example, to create an admin role:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py user create_role -n admin

Role admin created successfully.
</pre></div>
</div>
<p>Right now only an <tt class="docutils literal"><span class="pre">admin</span></tt> role is defined on the site, but others will be
setup in the future.</p>
</div>
<div class="section" id="users">
<h3>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h3>
<p>You can create a user without <a class="reference internal" href="#roles">Roles</a> existing, but it makes sense to have them
setup first. Once roles are setup <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">user</span> <span class="pre">create_user</span></tt> allows
you to create a new account based on an email address.</p>
<dl class="option">
<dt id="cmdoption-create_user-u">
<span id="cmdoption-create_user--user"></span><tt class="descname">-u</tt><tt class="descclassname"> &lt;name&#64;server.com&gt;</tt><tt class="descclassname">, </tt><tt class="descname">--user</tt><tt class="descclassname"> &lt;name&#64;server.com&gt;</tt><a class="headerlink" href="#cmdoption-create_user-u" title="Permalink to this definition">¶</a></dt>
<dd><p>User name</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-create_user-p">
<span id="cmdoption-create_user--password"></span><tt class="descname">-p</tt><tt class="descclassname"> &lt;password&gt;</tt><tt class="descclassname">, </tt><tt class="descname">--password</tt><tt class="descclassname"> &lt;password&gt;</tt><a class="headerlink" href="#cmdoption-create_user-p" title="Permalink to this definition">¶</a></dt>
<dd><p>Password</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-create_user-a">
<span id="cmdoption-create_user--active"></span><tt class="descname">-a</tt><tt class="descclassname"> &lt;y&gt; or &lt;active&gt;</tt><tt class="descclassname">, </tt><tt class="descname">--active</tt><tt class="descclassname"> &lt;y&gt; or &lt;active&gt;</tt><a class="headerlink" href="#cmdoption-create_user-a" title="Permalink to this definition">¶</a></dt>
<dd><p>Is the user activated and allowed to log in?</p>
</dd></dl>

<p>For example, to add and activate a user:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py user create_user -u <span class="nb">test</span>@server.com -p password -y a

User created sucessfully.
<span class="o">{</span>
    <span class="s2">&quot;active&quot;</span>: <span class="nb">true</span>,
    <span class="s2">&quot;email&quot;</span>: <span class="s2">&quot;test@server.com&quot;</span>,
    <span class="s2">&quot;password&quot;</span>: <span class="s2">&quot;****&quot;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To give a user a specific role <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">user</span> <span class="pre">add_role</span></tt> is used</p>
<dl class="option">
<dt id="cmdoption-add_role-u">
<tt class="descname">-u</tt><tt class="descclassname"> &lt;name&#64;server.com&gt; or --user &lt;name&#64;server.com&gt;</tt><a class="headerlink" href="#cmdoption-add_role-u" title="Permalink to this definition">¶</a></dt>
<dd><p>Email address for user that you wish to add the role too</p>
</dd></dl>

<p>If we wanted the user that we just created to be an admin:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py user add_role -u <span class="nb">test</span>@server.com -r admin
Role <span class="s1">&#39;admin&#39;</span> added to user <span class="s1">&#39;test@server.com&#39;</span> successfully
</pre></div>
</div>
<p>Other user focused commands include <tt class="docutils literal"><span class="pre">activate_user</span></tt> and <tt class="docutils literal"><span class="pre">deactivate_user</span></tt> if
you didn&#8217;t explicitly activate a user upon account creation, or someone has been
misbehaving.</p>
<dl class="option">
<dt id="cmdoption-activate_user-u">
<tt class="descname">-u</tt><tt class="descclassname"> &lt;name&#64;server.com&gt; or --user &lt;name&#64;server.com&gt;</tt><a class="headerlink" href="#cmdoption-activate_user-u" title="Permalink to this definition">¶</a></dt>
<dd><p>Email address for the user that you wish to modify</p>
</dd></dl>

<p><tt class="docutils literal"><span class="pre">remove_role</span></tt> is to remove a role from a user</p>
<dl class="option">
<dt id="cmdoption-remove_role-u">
<tt class="descname">-u</tt><tt class="descclassname"> &lt;name&#64;server.com&gt; or --user &lt;name&#64;server.com&gt;</tt><a class="headerlink" href="#cmdoption-remove_role-u" title="Permalink to this definition">¶</a></dt>
<dd><p>Email address for the user that you wish to remove the role from</p>
</dd></dl>

</div>
</div>
<div class="section" id="running-everything">
<h2>Running Everything<a class="headerlink" href="#running-everything" title="Permalink to this headline">¶</a></h2>
<p>Now that hopefully all the bits and pieces are in place, you&#8217;ll need three
terminals to get the server going. Remote gages are managed by
<a class="reference external" href="http://celeryproject.org">Celery tasks</a> which will run in the first two.</p>
<p>The first will run the Celery workers.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>celery worker -A celery_worker.celery -l info

<span class="o">[</span>tasks<span class="o">]</span>
    . app.tasks.remote.fetch_h2oline_sample
    . app.tasks.remote.fetch_usgs_level_samples_all
    . app.tasks.remote.fetch_usgs_level_samples_chunk
    . app.tasks.remote.fetch_usgs_other_sample
    . fetch_remote_samples

<span class="o">[</span>2015-07-21 16:03:14,734: INFO/MainProcess<span class="o">]</span> Connected to redis://localhost:6379/1
<span class="o">[</span>2015-07-21 16:03:14,742: INFO/MainProcess<span class="o">]</span> mingle: searching <span class="k">for</span> neighbors
<span class="o">[</span>2015-07-21 16:03:15,753: INFO/MainProcess<span class="o">]</span> mingle: all alone
<span class="o">[</span>2015-07-21 16:03:15,765: WARNING/MainProcess<span class="o">]</span> celery@localhost ready.
</pre></div>
</div>
<p>The second will manage the periodic tasks.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>celery beat -A celery_worker.celery -l info

celery beat v3.1.18 <span class="o">(</span>Cipater<span class="o">)</span> is starting.
__    -    ... __   -        _
Configuration -&gt;
    . broker -&gt; redis://localhost:6379/1
    . loader -&gt; celery.loaders.app.AppLoader
    . scheduler -&gt; celery.beat.PersistentScheduler
    . db -&gt; celerybeat-schedule
    . logfile -&gt; <span class="o">[</span>stderr<span class="o">]</span>@%INFO
    . maxinterval -&gt; now <span class="o">(</span>0s<span class="o">)</span>
<span class="o">[</span>2015-07-21 16:04:29,520: INFO/MainProcess<span class="o">]</span> beat: Starting...
</pre></div>
</div>
<p>The third will run the server itself.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python manage.py runserver
* Running on http://127.0.0.1:5000/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
* Restarting with stat
</pre></div>
</div>
<p>Then you can go to <a class="reference external" href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a> (or whatever the last command showed),
and start creating things.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="fabfile.html" class="btn btn-neutral" title="fabfile.py" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Alex Kerney.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>